@using Kaizen.Models.ViewUserModel

@{
    Layout = "SidebarLayout";
}
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
<style>

    .viewuserCardBody {
        border: 1px solid #ebeef6;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
        background-color: white;
        padding: 10px;
    }

    #bd_active {
        background-color: rgb(16, 202, 147);
        color: white;
        font-size: small;
    }

    #bd_inactive {
        background-color: #ffa500;
        color: white;
        font-size: small;
    }

    .trsh {
        background-color: #ff0000;
        width: 30px;
        height: 30px;
        border-radius: 13%;
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
    }

    .table tbody tr td {
        vertical-align: middle;
        border-color: #d7dae3;
    }

    .table th, .table td {
        border: 1px solid #EEEEEE;
        padding: 5px 10px;
        font-size: 11px;
    }

    table {
        display: table;
        border-collapse: separate;
        box-sizing: border-box;
        text-indent: initial;
        unicode-bidi: isolate;
        border-spacing: 3px;
        border-color: gray;
        border: 2px solid #EEEEEE;
    }

    .page_heading {
        font-size: 13px;
    }
</style>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>

<div class="container-fluid p-2">
    <h4 class="text-left">View User</h4>
    <div class="custom-line mb-3"></div>
    <form>
        <div class="card p-3 mt-2 mb-2">
            <div class="form-row">
                <div class="form-group col-md-4">
                    <label for="inputName">Name</label>
                    <input type="text" id="inputName" class="form-control txt-width" placeholder="Name">
                </div>
                <div class="form-group col-md-4">
                    <label for="inputEmpID">Emp ID</label>
                    <input type="text" id="inputEmpID" class="form-control txt-width" placeholder="Employee ID">
                </div>
                <div class="form-group col-md-4">
                    <label for="inputEmail">Email</label>
                    <input type="email" id="inputEmail" class="form-control txt-width" placeholder="Email">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-4">
                    <label for="inputUserType">User Type</label>
                    <select id="inputUserType" class="form-control txt-width">
                        <option selected>All</option>
                        @if (Model.UserTypeList != null)
                        {
                            foreach (var userType in Model.UserTypeList)
                            {
                                <option value="@userType.UserTypeId">@userType.UserDesc</option>
                            }
                        }
                    </select>
                </div>
                <div class="form-group col-md-4">
                    <label for="inputDomain">Domain</label>
                    <select id="inputDomain" class="form-control txt-width">
                        <option selected>All</option>
                        @if (Model.DomainList != null)
                        {
                            @foreach (var domain in Model.DomainList)
                            {
                                <option value="@domain.id">@domain.DomainName</option>
                            }
                        }
                    </select>
                </div>
                <div class="form-group col-md-4">
                    <label for="inputDepartment">Department</label>
                    <select id="inputDepartment" class="form-control txt-width">
                        <option selected>All</option>
                    </select>
                </div>
                <input type="button" id="btn_filter" class="btn btn-block-custom btn-azure" style="width:345px;margin-left:4px" value="Filter" />
            </div>
        </div>
        <div class="custom-line mb-3"></div>
        <div class="card viewuserCardBody p-3" id="grid">
            <div class="loginbox-textbox">
                <div class="row">
                    <div class="form-group">
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-8">
                    <p style="font-weight:bold">Total Employees -@Model.UsergridList.Count</p>
                </div>
                <div class="col-md-4">
                    <button type="button" class="btn btn-block-custom btn-azure" style="width:100px;">Import Kaizen</button>
                    <button type="submit" class="btn btn-block-custom btn-azure" style="width:100px;">Kaizen Sorted</button>
                </div>
                </div>
            <div class="col-12"><hr></div>
            <div class="table-responsive">
                <table id="example" class="table table-striped table-bordered display" style="width:100%;table-layout:fixed">
                    <thead>
                        <tr>
                            <th id="EMPID">EMP ID</th>
                            <th id="NAME">NAME</th>
                            <th id="EMAIL">EMAIL</th>
                            <th id="GENDER">GENDER</th>
                            <th id="TOTALKAIZENPOSTED">TOTAL KAIZEN POSTED</th>
                            <th id="DOMAIN&DEPARTMENT">DOMAIN</th>
                            <th id="DOMAIN&DEPARTMENT">DEPARTMENT</th>
                            <th id="USERTYPE">USER TYPE</th>
                            <th id="IMGAPPROVAL">IMG APPROVAL</th>
                            <th id="STATUS">STATUS</th>
                            <th id="ACTION">ACTION</th>
                        </tr>
                    </thead>
                    <tbody style="text-align:center">
                        @if (Model.UsergridList != null)
                        {
                            @foreach (var User in Model.UsergridList)
                            {
                                <tr>
                                    <td class="Userid">@User.EmpID</td>
                                    <td>@User.Name</td>
                                    <td>@User.Email</td>
                                    <td>@User.Gender</td>
                                    <td>0</td>
                                    <td>@User.Domain</td>
                                    <td>@User.Department</td>
                                    <td>@User.UserType</td>
                                    <td><input type="checkbox" style="background-color:gray" @(User.ImageApprover == 1 ? "checked" : "") disabled /></td>
                                    <td>
                                        @if (@User.Status == 0)
                                        {
                                            <a><span class="btn btn-danger badge-sm">InActive</span></a>

                                        }
                                        @if (@User.Status == 1)
                                        {
                                            <a><span class="btn btn-success badge-sm">Active</span></a>

                                        }
                                    </td>
                                    <td class="text-center">
                                        <a id="edituser" class="btn btn-primary btn-sm edituser">
                                            <i class="edit fas fa-solid fa-pencil"></i>
                                        </a>
                                        <a id="deleteuser" class="btn btn-danger btn-sm deleteuser" data-empid="@User.EmpID">
                                            <i class="fa-solid fa-trash-can"></i>
                                        </a>
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
        <script type="text/javascript">
            $(document).ready(function () {
                $('#example').DataTable();
            });
        </script>
        <script>
            $(document).ready(function () {
                $('#inputDomain').change(function () {
                    var Domain = $('#inputDomain').val();
                    if (Domain.toLowerCase() === 'all') {
                        return;
                    }
                   $.ajax({
                        type: 'POST',
                        url: '/ViewUser/FetchDepartment',
                        dataType: "json",
                        data: { DomainName: Domain },
                        success: function (result) {
                            if (result) {
                                var dropdown = $('#inputDepartment');
                                dropdown.empty();
                                dropdown.append($('<option>', {
                                    value: 'all',
                                    text: 'All'
                                }));
                                for (var i = 0; i < result.length; i++) {
                                    $('#inputDepartment').append('<option value="' + result[i].deptId + '">' + result[i].departmentName + '</option>');
                                }
                            }
                            else {
                                swal('Please Select Domain');
                            }
                        },
                        error: function (error) {
                        }
                    });
                });
            });
        </script>
        <script>
                $(document).ready(function () {
                $("#btn_filter").button().click(function () {
                    var Name = $('#inputName').val();
                    var EmpId = $('#inputEmpID').val();
                    var Email = $('#inputEmail').val();
                    var UserType = $('#inputUserType option:selected').text();
                    var Domain = $('#inputDomain option:selected').text();
                    var Department = $('#inputDepartment option:selected').text();
                        $.ajax({
                            url: '/ViewUser/ViewFilterUser',
                            type: 'GET',
                            data: {
                                Name: Name, EmpId: EmpId, Email: Email, UserType: UserType, Domain: Domain, Department: Department
                            },
                            success: function (response) {
                                var tbody = $('#example tbody');
                                tbody.empty();

                            if (response && response.length > 0) {
                                for (var i = 0; i < response.length; i++) {
                                    var user = response[i];

                                    var statusHtml = user.status == 0
                                        ? '<a><span class="btn btn-danger badge-sm">InActive</span></a>'
                                        : '<a><span class="btn btn-success badge-sm">Active</span></a>';

                                    var row = '<tr>' +
                                        '<td class="Userid">' + user.empID + '</td>' +
                                        '<td>' + user.name + '</td>' +
                                        '<td>' + user.email + '</td>' +
                                        '<td>' + user.gender + '</td>' +
                                        '<td>' + "0" + '</td>' +
                                        '<td>' + user.domain + '</td>' +
                                        '<td>' + user.department + '</td>' +
                                        '<td>' + user.userType + '</td>' +
                                        '<td><input type="checkbox" style="background-color:gray"' + (user.imageApprover == 1 ? ' checked' : '') + ' disabled /></td>' +
                                        '<td>' + statusHtml + '</td>' +
                                        '<td class="text-center">' +
                                        '<a class="btn btn-primary btn-sm edituser">' +
                                        '<i class="edit fas fa-solid fa-pencil"></i>' +
                                        '</a> ' +
                                        '<a id="deleteuser" class="btn btn-danger btn-sm deleteuser" data-empid="' + user.empID + '">' +
                                        '<i class="fa-solid fa-trash-can"></i>' +
                                        '</a>' +
                                        '</td>' +
                                        '</tr>';

                                    tbody.append(row);
                                }
                            }

                                else {
                                    var row = '<tr><td colspan="6">No users found</td></tr>';
                                    tbody.append(row);
                                }
                            },
                            error: function (xhr, status, error) {
                                console.error('Error fetching users:', error);
                            }
                        });
                    });
                });
        </script>
        <script>
            $(document).ready(function () {
                $('tbody').on('click', '.deleteuser', function (e) {
                    e.preventDefault();
                    var empid = $(this).data('empid'); // Get the empid from data-empid attribute
                    $.ajax({
                        url: '/ViewUser/DeleteUser',
                        method: 'POST',
                        data: { id: empid },
                        success: function (response) {
                            swal('User Deleted Sucessfully');
                        },
                        error: function (xhr, status, error) {
                            swal('Delete user error');
                        }
                    });
                });
            });
        </script>
    </form>
</div>

